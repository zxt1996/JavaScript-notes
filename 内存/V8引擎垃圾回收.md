# V8引擎垃圾回收
## V8内存限制
在64位系统下，V8最多只能分配1.4G, 在 32 位系统中，最多只能分配0.7G。  

#### 设置内存上限的原因
1. JS单线程的执行机制
2. JS垃圾回收机制的限制  

> JS是单线程的，一旦进入垃圾回收，其他运行逻辑就会暂停，而垃圾回收是非常耗时的操作。  

## 新生代内存的回收
V8把堆内存分成了**新生代内存和老生代内存**  

1. 新生代内存：临时分配的内存，存活时间短
2. 老生代：常驻内存  

### 新生代内存组成
1. 正在使用的内存
2. 闲置的内存  

### 老生代内存的回收
新生代中的变量如果经过多次回收后依然存在，那么就会被放入到老生代内存中，这种现象就叫**晋升**。  

触发原因：  
1. 已经经历过一次Scavenge回收
2. 闲置空间的内存占用超过25%  

回收策略：  

1. 标记-清除
2. 整理内存碎片

## 增量标记
V8 采取了增量标记的方案，即将一口气完成的标记任务分为很多小的部分完成，每做完一个小的部分就"歇"一下，就js应用逻辑执行一会儿，然后再执行下面的部分，如果循环，直到标记阶段完成才进入内存碎片的整理上面来。