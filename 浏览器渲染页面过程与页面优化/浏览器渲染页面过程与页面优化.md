# 浏览器渲染页面过程与页面优化
## 1.从用户输入浏览器输入url到页面最后呈现 有哪些过程？
> 答案大致如下：

    1.用户输入URL地址  

    2.浏览器解析URL解析出主机名

    3.浏览器将主机名转换成服务器ip地址（浏览器先查找本地DNS缓存列表 没有的话 再向浏览器默认的DNS服务器发送查询请求 同时缓存）

    4.浏览器将端口号从URL中解析出来

    5.浏览器建立一条与目标Web服务器的TCP连接（三次握手）

    6.浏览器向服务器发送一条HTTP请求报文

    7.服务器向浏览器返回一条HTTP响应报文

    8.关闭连接 浏览器解析文档

    9.如果文档中有资源 重复6 7 8 动作 直至资源全部加载完毕  
可以总结为一下几点：
```
1.DNS 查询
2.TCP 连接
3.HTTP 请求即响应
4.服务器响应
5.客户端渲染
```
## 2.浏览器渲染主要过程
    1.HTML解析出DOM Tree
    2.CSS解析出Style Rules
    3.将二者关联生成Render Tree
    4.Layout 根据Render Tree计算每个节点的信息
    5.Painting 根据计算好的信息绘制整个页面
### 2.1HTML解析
将文本的HTML文档，提炼出关键信息，嵌套层级的树形结构，便于计算拓展。这就是HTML Parser的作用。
```
<html>
<head>
    <title>Web page parsing</title>
</head>
<body>
    <div>
        <h1>Web page parsing</h1>
        <p>This is an example Web page.</p>
    </div>
</body>
</html>
```
经过解析之后的DOM Tree差不多就是  
![](img/html解析.png)
### 2.2CSS解析
于HTML Parser相似，CSS Parser作用就是将很多个CSS文件中的样式合并解析出具有树形结构Style Rules。
### 2.3脚本处理
浏览器解析文档，当遇到\<script>标签的时候，会立即解析脚本，停止解析文档（因为JS可能会改动DOM和CSS，所以继续解析会造成浪费）。  
如果脚本是外部的，会等待脚本下载完毕，再继续解析文档。现在可以在script标签上增加属性 defer或者async。  
脚本解析会将脚本中改变DOM和CSS的地方分别解析出来，追加到DOM Tree和Style Rules上。
### 2.4呈现树（Render Tree）
Render Tree的构建其实就是DOM Tree和CSSOM Attach的过程。  
![](img/呈现树.png)
### 2.5布局Layout
这个过程就是通过渲染树中渲染对象的信息，计算出每一个渲染对象的位置和尺寸，将其安置在浏览器窗口的正确位置。
### 2.6绘制（Painting）
在绘制阶段，系统会遍历呈现树，并调用呈现器的“paint”方法，将呈现器的内容显示在屏幕上。绘制工作是使用用户界面基础组件完成的。
## 3.页面渲染优化
    1.HTML文档结构层次尽量少，最好不深于六层；

    2.脚本尽量后放，放在前即可；

    3.少量首屏样式内联放在标签内；

    3.样式结构层次尽量简单；

    4.在脚本中尽量减少DOM操作，尽量缓存访问DOM的样式信息，避免过度触发回流；

    5.减少通过JavaScript代码修改元素样式，尽量使用修改class名方式操作样式或动画；

    6.动画尽量使用在绝对定位或固定定位的元素上；

    7.隐藏在屏幕外，或在页面滚动时，尽量停止动画；

    8.尽量缓存DOM查找，查找器尽量简洁；

    9.涉及多域名的网站，可以开启域名预解析