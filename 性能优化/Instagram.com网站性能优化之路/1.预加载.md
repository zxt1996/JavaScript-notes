# 资源预加载
确定正确的资源下载和执行的优先级，并减少页面加载期间的浏览器卡顿时间是提高Web应用程序性能的主要手段之一。  

## JS、XHR和图片预加载
那些由JavaScript动态获取的资源（其他脚本，图像，XHR请求等），因为浏览器只有先解析并执行一些其他JavaScript才能发现这些依赖资源。  

可以向浏览器提示它应该立即开始获取这些资源  

- 使用HTML预加载标签  

```
<link rel="preload" href="my-js-file.js" as="script" type="text/javascript" />
```

> 预加载提示用于关键页面加载路径上的两种资源  

- 动态加载的JS
- 预加载XHR GraphQL数据请求  

> 动态加载的脚本是通过import（'...'）为特定客户端路由加载的脚本。我们维护服务器端入口点和客户端路由脚本之间的映射列表-因此，当我们在服务器端收到页面请求时，我们知道特定服务器端入口点将需要哪些客户端路由脚本，并且我们可以在渲染初始页面HTML时为这些特定于路由的脚本添加预加载。

## 预加载优先级
**链接预加载会增加异步脚本下载的网络优先级**  

## 图片预加载
- 我们不希望屏幕外批量加载占用用户当前正在查看的部分Feed的CPU和带宽优先级。

- 我们不想过分地预加载内容，以免浪费用户带宽，而用户可能再也不需要向下滚动查看内容，但是另一方面，如果预加载不足，则用户经常会在信息流结尾阻塞 。

- Instagram.com设计为可在各种屏幕尺寸和设备上使用，因此我们使用img srcset属性（可让浏览器根据用户屏幕尺寸决定使用哪种图像分辨率）来显示提要图像。这意味着确定要预加载的图像分辨率并不容易，并且存在预加载浏览器永远不会使用的图像的风险。  

> 构建一个优先任务，以处理异步工作的排队（在这种情况下，是下一批帖子的预加载）。预加载任务最初以空闲优先级排队（使用requestIdleCallback），因此除非浏览器未做任何其他重要工作，否则它不会开始。但是，如果用户滚动到离当前内容的末尾足够近的时候，我们将通过取消挂起的空闲回调并将此预加载任务立即触发，从而将该预加载任务的优先级提高到“高优先级”。  

> window.requestIdleCallback()方法将在浏览器的空闲时段内调用的函数排队。这使开发人员能够在主事件循环上执行后台和低优先级工作，而不会影响延迟关键事件，如动画和输入响应。  
> requestIdleCallback则会在某一帧结束后的空闲时间或者用户处于不活跃状态时，处理我们的工作。这表明在不获取用户行为条件下，你能执行相关的工作。  


